---
// ========================================
// INTRO SECTION COMPONENT
// Reusable introductory text block for static pages
// Centered layout with clean typographic hierarchy
// Optional decorative images on left and right sides
// ========================================

import type { PageContent } from '../../../lib/pages'
import { getSectionTitle, getSectionContent } from '../../../lib/pages'

// ----------------------------------------
// TYPE DEFINITIONS
// ----------------------------------------

type Alignment = 'center' | 'left'
type BackgroundVariant = 'white' | 'light' | 'dark'

interface ImageProps {
  src: string
  alt?: string
}

interface Props {
  // CMS Integration
  blockKey?: string
  pageContent?: PageContent | null

  // Content props
  title?: string
  subtitle?: string
  description?: string

  // Primary CTA
  ctaText?: string
  ctaLink?: string

  // Secondary CTA (future-proof)
  secondaryCtaText?: string
  secondaryCtaLink?: string

  // Decorative images
  imageLeft?: ImageProps
  imageRight?: ImageProps

  // Layout options
  alignment?: Alignment
  backgroundVariant?: BackgroundVariant

  // Styling options
  maxWidth?: string
  topPadding?: boolean
  bottomPadding?: boolean
}

// ----------------------------------------
// COMPONENT PROPS
// ----------------------------------------

const {
  // CMS Integration
  blockKey,
  pageContent,

  // Content
  title,
  subtitle,
  description,

  // Primary CTA
  ctaText,
  ctaLink,

  // Secondary CTA
  secondaryCtaText,
  secondaryCtaLink,

  // Decorative images
  imageLeft,
  imageRight,

  // Layout
  alignment = 'center',
  backgroundVariant = 'white',

  // Styling
  maxWidth = '48rem',
  topPadding = true,
  bottomPadding = true,
} = Astro.props

// Check if we have any side images
const hasImages = imageLeft || imageRight

// ----------------------------------------
// CMS CONTENT RESOLUTION
// ----------------------------------------

const cmsTitle = blockKey && pageContent ? getSectionTitle(pageContent, blockKey, title) : title
const cmsContent = blockKey && pageContent ? getSectionContent(pageContent, blockKey, description) : description

const finalTitle = cmsTitle || title
const finalDescription = cmsContent || description

// ----------------------------------------
// CLASS BUILDING
// ----------------------------------------

const sectionClasses = [
  'intro-section',
  `intro-section--${alignment}`,
  `intro-section--bg-${backgroundVariant}`,
  hasImages && 'intro-section--with-images',
  !topPadding && 'intro-section--no-top-padding',
  !bottomPadding && 'intro-section--no-bottom-padding',
].filter(Boolean).join(' ')

// Check if we have any CTAs
const hasPrimaryCta = ctaText && ctaLink
const hasSecondaryCta = secondaryCtaText && secondaryCtaLink
const hasCtaButtons = hasPrimaryCta || hasSecondaryCta
---

<section class={sectionClasses}>
  <div class="intro-section__layout">
    {/* Left Decorative Image */}
    {hasImages && (
      <div class="intro-section__image intro-section__image--left">
        {imageLeft ? (
          <img src={imageLeft.src} alt={imageLeft.alt || ''} loading="lazy" />
        ) : (
          <div class="intro-section__image-spacer"></div>
        )}
      </div>
    )}

    {/* Center Content */}
    <div class="intro-section__container" style={`--intro-max-width: ${maxWidth};`}>
      {subtitle && (
        <span class="intro-section__subtitle">{subtitle}</span>
      )}

      {finalTitle && (
        <h2 class="intro-section__title">{finalTitle}</h2>
      )}

      {finalDescription && (
        <div class="intro-section__description" set:html={finalDescription} />
      )}

      {hasCtaButtons && (
        <div class="intro-section__actions">
          {hasPrimaryCta && (
            <a href={ctaLink} class="intro-section__btn intro-section__btn--primary">
              {ctaText}
            </a>
          )}

          {hasSecondaryCta && (
            <a href={secondaryCtaLink} class="intro-section__btn intro-section__btn--secondary">
              {secondaryCtaText}
            </a>
          )}
        </div>
      )}
    </div>

    {/* Right Decorative Image */}
    {hasImages && (
      <div class="intro-section__image intro-section__image--right">
        {imageRight ? (
          <img src={imageRight.src} alt={imageRight.alt || ''} loading="lazy" />
        ) : (
          <div class="intro-section__image-spacer"></div>
        )}
      </div>
    )}
  </div>
</section>

<style lang="scss">
  @use '../../../styles/components/intro-section';
</style>
